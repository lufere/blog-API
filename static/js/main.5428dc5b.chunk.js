(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{135:function(e,t,n){},139:function(e,t){},141:function(e,t){},155:function(e,t){},157:function(e,t){},185:function(e,t){},187:function(e,t){},188:function(e,t){},193:function(e,t){},195:function(e,t){},214:function(e,t){},226:function(e,t){},229:function(e,t){},246:function(e,t,n){},247:function(e,t,n){},252:function(e,t,n){},253:function(e,t,n){"use strict";n.r(t);var s=n(0),c=n(1),o=n.n(c),r=n(127),a=n.n(r),i=(n(135),n(21)),l=n(8),u=n(5),j=n(128),d=n.n(j),m=(n(246),n(247),function(e){var t=Object(u.g)().id;if(Object(c.useEffect)((function(){return e.checkExpiration(),Promise.all([fetch("/posts/"+t),fetch("/posts/"+t+"/comments")]).then((function(t){var n=t.map((function(e){return e.json()}));Promise.all(n).then((function(t){setTimeout((function(){e.setPostDetail(t[0].post),e.setPostComments(t[1].comments)}),1100)}))})),function(){e.setPostDetail(""),e.setPostComments(null)}}),[]),null!=e.comments){console.log("this",e.comments[0]);var n=e.comments.map((function(e){return Object(s.jsxs)("div",{className:"comment",children:[Object(s.jsxs)("p",{children:["By ",e.author?e.author.username:"Anonymous"]}),Object(s.jsx)("p",{children:e.content}),Object(s.jsx)("p",{children:e.timestamp_formatted})]},e._id)}))}return e.data?Object(s.jsxs)("div",{children:[Object(s.jsx)("h1",{children:e.data.title}),Object(s.jsx)("p",{children:e.data.author?e.data.author.username:null}),Object(s.jsx)("p",{children:e.data.content}),Object(s.jsxs)("p",{children:["Published on: ",e.data.timestamp_formatted]}),Object(s.jsx)("h2",{children:"Comments"}),n,localStorage.getItem("currentUser")?Object(s.jsx)("form",{children:Object(s.jsxs)("label",{children:[" Make a comment:",Object(s.jsx)("textarea",{name:"comment",value:e.comment,onChange:e.onChange}),Object(s.jsx)("button",{onClick:function(n){n.preventDefault(),fetch("/posts/".concat(t,"/comments/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")},body:JSON.stringify({content:e.comment})}).then((function(e){return e.json()})).then((function(n){fetch("/posts/"+t+"/comments").then((function(e){return e.json()})).then((function(t){e.setPostComments(t.comments),e.setComment("")})).catch((function(e){return console.error(e)}))})).catch((function(e){return console.error(e)}))},type:"submit",children:"Submit"})]})}):Object(s.jsxs)("p",{className:"userRequired",children:["You need to be a user to leave comments.",Object(s.jsx)(l.b,{to:"/login",children:" Log in "}),"or",Object(s.jsx)(l.b,{to:"/signup",children:" Sign up "})]})]}):Object(s.jsxs)("div",{className:"spinner",children:[Object(s.jsx)("div",{className:"rect1"}),Object(s.jsx)("div",{className:"rect2"}),Object(s.jsx)("div",{className:"rect3"}),Object(s.jsx)("div",{className:"rect4"}),Object(s.jsx)("div",{className:"rect5"})]})}),h=function(e){var t=Object(u.f)();return Object(c.useEffect)((function(){e.setUsername(""),e.setPassword("")}),[]),JSON.parse(localStorage.getItem("currentUser"))?Object(s.jsxs)("div",{children:[Object(s.jsx)(l.b,{to:"/",children:"Back"}),Object(s.jsxs)("p",{children:["You're already logged in ",JSON.parse(localStorage.getItem("currentUser")).username]})]}):Object(s.jsxs)("div",{children:[Object(s.jsx)("h3",{children:"Log in"}),Object(s.jsxs)("form",{children:[Object(s.jsxs)("label",{children:["Username:",Object(s.jsx)("input",{name:"username",id:"username",type:"text",value:e.username,onChange:e.onChange})]}),Object(s.jsxs)("label",{children:["Password:",Object(s.jsx)("input",{name:"password",id:"password",type:"password",value:e.password,onChange:e.onChange})]}),Object(s.jsx)("button",{onClick:function(n){n.preventDefault(),fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password})}).then((function(e){return e.json()})).then((function(n){if(console.log(n.status),400===n.status&&(console.log("info",n.info),n.info&&n.info.message&&alert(n.info.message),e.setPassword("")),200===n.status){var s=n.token,c=n.user;console.log("user",n.user),localStorage.setItem("currentUser",JSON.stringify(c)),localStorage.setItem("authToken",s),e.setUsername(""),e.setPassword(""),t.push("/")}})).catch((function(e){return console.error(e)}))},type:"submit",children:"Log In"})]})]})},b=(n(252),function(e){return Object(s.jsx)(l.b,{to:"/posts/"+e.postId,children:Object(s.jsxs)("div",{className:"blogPreview",children:[Object(s.jsx)("h1",{children:e.title}),Object(s.jsx)("p",{children:e.author}),Object(s.jsx)("p",{children:e.content})]})})}),O=function(e){Object(c.useEffect)((function(){e.checkExpiration(),fetch("/posts").then((function(e){return e.json()})).then((function(t){setTimeout((function(){e.setPosts(t.post_list)}),1100)})).catch((function(e){return console.error("Error: ".concat(e))}))}),[]);var t=e.posts.map((function(e){return Object(s.jsx)(b,{title:e.title,author:e.author?e.author.username:null,content:e.content,postId:e._id},e.title+" - "+e.author)}));return 0===e.posts.length?Object(s.jsxs)("div",{className:"spinner",children:[Object(s.jsx)("div",{className:"rect1"}),Object(s.jsx)("div",{className:"rect2"}),Object(s.jsx)("div",{className:"rect3"}),Object(s.jsx)("div",{className:"rect4"}),Object(s.jsx)("div",{className:"rect5"})]}):Object(s.jsx)("div",{className:"App",children:Object(s.jsx)("div",{className:"App-header",children:t})})},f=function(e){return Object(c.useEffect)((function(){})),localStorage.getItem("currentUser")?Object(s.jsxs)("header",{children:[Object(s.jsx)(l.b,{to:"/",children:"Blog API"}),Object(s.jsxs)("div",{children:[Object(s.jsxs)("p",{onClick:function(){return localStorage.clear()},children:["Welcome ",JSON.parse(localStorage.getItem("currentUser")).username]}),Object(s.jsx)("p",{onClick:function(){localStorage.clear(),window.location.reload()},className:"logout",children:"Logout"})]})]}):Object(s.jsxs)("header",{children:[Object(s.jsx)(l.b,{to:"/",children:"Blog API"}),Object(s.jsxs)("div",{children:[Object(s.jsx)("a",{href:"https://lufere.dev/blog-manager",children:"Blog Manager"}),Object(s.jsx)(l.b,{to:"/login",children:"Login"}),Object(s.jsx)(l.b,{to:"/signup",children:"Sign up"})]})]})},p=function(e){var t=Object(u.f)();return Object(c.useEffect)((function(){e.setUsername(""),e.setPassword("")}),[]),Object(s.jsxs)("div",{className:"signup",children:[Object(s.jsx)("h3",{children:"Sign up"}),Object(s.jsxs)("form",{children:[Object(s.jsxs)("label",{children:[" Username",Object(s.jsx)("input",{type:"text",name:"username",value:e.username,onChange:e.onChange})]}),Object(s.jsxs)("label",{children:[" Password",Object(s.jsx)("input",{type:"password",name:"password",value:e.password,onChange:e.onChange})]}),Object(s.jsx)("button",{type:"submit",onClick:function(n){n.preventDefault(),fetch("/sign-up",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password,creator:!0})}).then((function(e){return e.json()})).then((function(n){if(console.log(n),400===n.status&&(console.log("info",n.errors),n.info&&n.info.message&&alert(n.info.message),n.errors&&n.errors.forEach((function(e){return alert(e.msg)})),e.setPassword("")),200===n.status){var s=n.token,c=n.user;console.log("user",n.user),localStorage.setItem("currentUser",JSON.stringify(c)),localStorage.setItem("authToken",s),e.setUsername(""),e.setPassword(""),t.push("/")}})).catch((function(e){return console.error(e)}))},children:"Sign up"})]})]})};var x=function(){var e=Object(c.useState)([]),t=Object(i.a)(e,2),n=t[0],o=t[1],r=Object(c.useState)(""),a=Object(i.a)(r,2),j=a[0],b=a[1],x=Object(c.useState)([]),g=Object(i.a)(x,2),v=g[0],S=g[1],w=Object(c.useState)(""),C=Object(i.a)(w,2),P=C[0],N=C[1],y=Object(c.useState)(""),k=Object(i.a)(y,2),I=k[0],U=k[1],T=Object(c.useState)(""),E=Object(i.a)(T,2),J=E[0],B=E[1];function D(e){var t=e.target.name,n=e.target.value;"username"===t&&U(n),"password"===t&&B(n),"comment"===t&&N(n)}function A(){if(localStorage.getItem("authToken")){var e=!1,t=localStorage.getItem("authToken"),n=d.a.decode(t,{complete:!0}),s=new Date;n.payload.exp<s.getTime()/1e3&&(e=!0),e&&localStorage.clear()}}return Object(s.jsxs)(l.a,{children:[Object(s.jsx)(f,{checkExpiration:A}),Object(s.jsxs)(u.c,{children:[Object(s.jsx)(u.a,{exact:!0,path:"/",children:Object(s.jsx)(O,{setPosts:o,posts:n,checkExpiration:A})}),Object(s.jsx)(u.a,{path:"/posts/:id",children:Object(s.jsx)(m,{data:j,comments:v,setPostDetail:b,setPostComments:S,comment:P,setComment:N,onChange:D,checkExpiration:A})}),Object(s.jsx)(u.a,{path:"/login",children:Object(s.jsx)(h,{username:I,password:J,setUsername:U,setPassword:B,onChange:D})}),Object(s.jsx)(u.a,{path:"/signup",children:Object(s.jsx)(p,{username:I,password:J,setUsername:U,setPassword:B,onChange:D})})]})]})};a.a.render(Object(s.jsx)(o.a.StrictMode,{children:Object(s.jsx)(x,{})}),document.getElementById("root"))}},[[253,1,2]]]);
//# sourceMappingURL=main.5428dc5b.chunk.js.map