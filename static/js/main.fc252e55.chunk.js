(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{135:function(e,t,n){},139:function(e,t){},141:function(e,t){},155:function(e,t){},157:function(e,t){},185:function(e,t){},187:function(e,t){},188:function(e,t){},193:function(e,t){},195:function(e,t){},214:function(e,t){},226:function(e,t){},229:function(e,t){},246:function(e,t,n){},247:function(e,t,n){},252:function(e,t,n){"use strict";n.r(t);var s=n(0),c=n(1),o=n.n(c),a=n(127),r=n.n(a),i=(n(135),n(21)),l=n(8),j=n(5),u=n(128),h=n.n(u),m=(n(246),n(247),function(e){var t=Object(j.g)().id;if(Object(c.useEffect)((function(){return e.checkExpiration(),Promise.all([fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/")+t),fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/").concat(t,"/comments"))]).then((function(t){var n=t.map((function(e){return e.json()}));Promise.all(n).then((function(t){setTimeout((function(){e.setPostDetail(t[0].post),e.setPostComments(t[1].comments)}),1100)}))})),function(){e.setPostDetail(""),e.setPostComments(null)}}),[]),null!=e.comments){console.log("this",e.comments[0]);var n=e.comments.map((function(e){return Object(s.jsxs)("div",{className:"comment",children:[Object(s.jsxs)("p",{children:[e.author?e.author.username:"Anonymous"," said: "]}),Object(s.jsx)("p",{children:e.content}),Object(s.jsxs)("p",{children:["On ",e.timestamp_formatted]})]},e._id)}))}return e.data?Object(s.jsx)("div",{className:"blogDetailContainer",children:Object(s.jsxs)("div",{className:"blogDetail",children:[Object(s.jsx)("h1",{children:e.data.title}),Object(s.jsxs)("p",{className:"detailAuthor",children:["By ",e.data.author?e.data.author.username:null]}),Object(s.jsx)("p",{children:e.data.content}),Object(s.jsxs)("p",{className:"detailPublished",children:["Published on: ",e.data.timestamp_formatted]}),Object(s.jsx)("h2",{children:"Comments"}),Object(s.jsx)("div",{className:"commentContainer",children:n}),localStorage.getItem("currentUser")?Object(s.jsx)("form",{children:Object(s.jsxs)("label",{children:[" Make a comment:",Object(s.jsx)("textarea",{name:"comment",value:e.comment,onChange:e.onChange}),Object(s.jsx)("button",{onClick:function(n){n.preventDefault(),fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/").concat(t,"/comments/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")},body:JSON.stringify({content:e.comment})}).then((function(e){return e.json()})).then((function(n){fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/").concat(t,"/comments")).then((function(e){return e.json()})).then((function(t){e.setPostComments(t.comments),e.setComment("")})).catch((function(e){return console.error(e)}))})).catch((function(e){return console.error(e)}))},type:"submit",children:"Submit"})]})}):Object(s.jsxs)("p",{className:"userRequired",children:["You need to be a user to leave comments.",Object(s.jsx)(l.b,{to:"/login",children:" Log in "}),"or",Object(s.jsx)(l.b,{to:"/signup",children:" Sign up "})]})]})}):Object(s.jsx)("div",{className:"spinnerContainer",children:Object(s.jsxs)("div",{className:"spinner",children:[Object(s.jsx)("div",{className:"rect1"}),Object(s.jsx)("div",{className:"rect2"}),Object(s.jsx)("div",{className:"rect3"}),Object(s.jsx)("div",{className:"rect4"}),Object(s.jsx)("div",{className:"rect5"})]})})}),d=function(e){var t=Object(j.f)();return Object(c.useEffect)((function(){e.setUsername(""),e.setPassword("")}),[]),JSON.parse(localStorage.getItem("currentUser"))?Object(s.jsxs)("div",{children:[Object(s.jsx)(l.b,{to:"/",children:"Back"}),Object(s.jsxs)("p",{children:["You're already logged in ",JSON.parse(localStorage.getItem("currentUser")).username]})]}):Object(s.jsx)("div",{className:"userFormContainer",children:Object(s.jsxs)("div",{className:"userForm",children:[Object(s.jsx)("h3",{children:"Log in"}),Object(s.jsxs)("form",{children:[Object(s.jsxs)("label",{children:["Username",Object(s.jsx)("input",{name:"username",id:"username",type:"text",value:e.username,onChange:e.onChange})]}),Object(s.jsxs)("label",{children:["Password",Object(s.jsx)("input",{name:"password",id:"password",type:"password",value:e.password,onChange:e.onChange})]}),Object(s.jsxs)("p",{children:["Don't have an account? ",Object(s.jsx)(l.b,{to:"/signup",children:"Sign Up"})]}),Object(s.jsx)("button",{onClick:function(n){n.preventDefault(),fetch("".concat("https://odin-blogapi.herokuapp.com","/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password})}).then((function(e){return e.json()})).then((function(n){if(console.log(n.status),400===n.status&&(console.log("info",n.info),n.info&&n.info.message&&alert(n.info.message),e.setPassword("")),200===n.status){var s=n.token,c=n.user;console.log("user",n.user),localStorage.setItem("currentUser",JSON.stringify(c)),localStorage.setItem("authToken",s),e.setUsername(""),e.setPassword(""),t.push("/")}})).catch((function(e){return console.error(e)}))},type:"submit",children:"Log In"})]})]})})},b=function(e){return Object(s.jsx)(l.b,{to:"/posts/"+e.postId,children:Object(s.jsx)("div",{className:"blogPreview",children:Object(s.jsxs)("div",{className:"content",children:[Object(s.jsx)("h1",{children:e.title}),Object(s.jsxs)("p",{className:"authorPreview",children:["Authored by ",Object(s.jsx)("span",{children:e.author?e.author:"Anonymous"})," on ",Object(s.jsx)("span",{children:e.timestamp})]}),Object(s.jsx)("p",{className:"contentPreview",children:e.content})]})})})},p=function(e){Object(c.useEffect)((function(){console.log("API","https://odin-blogapi.herokuapp.com"),e.checkExpiration(),fetch("".concat("https://odin-blogapi.herokuapp.com","/posts")).then((function(e){return e.json()})).then((function(t){setTimeout((function(){e.setPosts(t.post_list)}),1100)})).catch((function(e){return console.error("Error: ".concat(e))}))}),[]);var t=e.posts.map((function(e){if(e.published)return Object(s.jsx)(b,{title:e.title,author:e.author?e.author.username:null,content:e.content,postId:e._id,timestamp:e.timestamp_formatted},e.title+" - "+e.author)}));return 0===e.posts.length?Object(s.jsx)("div",{className:"spinnerContainer",children:Object(s.jsxs)("div",{className:"spinner",children:[Object(s.jsx)("div",{className:"rect1"}),Object(s.jsx)("div",{className:"rect2"}),Object(s.jsx)("div",{className:"rect3"}),Object(s.jsx)("div",{className:"rect4"}),Object(s.jsx)("div",{className:"rect5"})]})}):Object(s.jsx)("div",{className:"homepage",children:t})},O=function(e){return Object(c.useEffect)((function(){})),localStorage.getItem("currentUser")?Object(s.jsxs)("header",{children:[Object(s.jsx)(l.b,{className:"logo",to:"/",children:"Blog Viewer"}),Object(s.jsxs)("nav",{children:[Object(s.jsx)("a",{href:"https://lufere.dev/blog-manager/",children:"Blog Manager"}),Object(s.jsxs)("p",{children:["Welcome ",Object(s.jsx)("span",{children:JSON.parse(localStorage.getItem("currentUser")).username})]}),Object(s.jsx)("button",{onClick:function(){localStorage.clear(),window.location.reload()},className:"logout",children:"Logout"})]})]}):Object(s.jsxs)("header",{children:[Object(s.jsx)(l.b,{to:"/",children:"Blog Viewer"}),Object(s.jsxs)("nav",{children:[Object(s.jsx)("a",{href:"https://lufere.dev/blog-manager/",children:"Blog Manager"}),Object(s.jsx)(l.b,{to:"/login",children:"Login"}),Object(s.jsx)(l.b,{to:"/signup",children:"Sign up"})]})]})},f=function(e){var t=Object(j.f)();return Object(c.useEffect)((function(){e.setUsername(""),e.setPassword("")}),[]),Object(s.jsx)("div",{className:"userFormContainer",children:Object(s.jsxs)("div",{className:"userForm",children:[Object(s.jsx)("h3",{children:"Sign up"}),Object(s.jsxs)("form",{children:[Object(s.jsxs)("label",{children:[" Username",Object(s.jsx)("input",{type:"text",name:"username",value:e.username,onChange:e.onChange})]}),Object(s.jsxs)("label",{children:[" Password",Object(s.jsx)("input",{type:"password",name:"password",value:e.password,onChange:e.onChange})]}),Object(s.jsxs)("p",{children:["Already have an account? ",Object(s.jsx)(l.b,{to:"/login",children:" Log In"})]}),Object(s.jsx)("button",{className:"signupSubmit",type:"submit",onClick:function(n){n.preventDefault(),fetch("".concat("https://odin-blogapi.herokuapp.com","/sign-up"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password,creator:!0})}).then((function(e){return e.json()})).then((function(n){if(console.log(n),400===n.status&&(console.log("info",n.errors),n.info&&n.info.message&&alert(n.info.message),n.errors&&n.errors.forEach((function(e){return alert(e.msg)})),e.setPassword("")),200===n.status){var s=n.token,c=n.user;console.log("user",n.user),localStorage.setItem("currentUser",JSON.stringify(c)),localStorage.setItem("authToken",s),e.setUsername(""),e.setPassword(""),t.push("/")}})).catch((function(e){return console.error(e)}))},children:"Sign up"})]})]})})};var g=function(){var e=Object(c.useState)([]),t=Object(i.a)(e,2),n=t[0],o=t[1],a=Object(c.useState)(""),r=Object(i.a)(a,2),u=r[0],b=r[1],g=Object(c.useState)([]),x=Object(i.a)(g,2),v=x[0],N=x[1],S=Object(c.useState)(""),w=Object(i.a)(S,2),C=w[0],P=w[1],k=Object(c.useState)(""),y=Object(i.a)(k,2),I=y[0],U=y[1],T=Object(c.useState)(""),E=Object(i.a)(T,2),D=E[0],J=E[1];function B(e){var t=e.target.name,n=e.target.value;"username"===t&&U(n),"password"===t&&J(n),"comment"===t&&P(n)}function A(){if(localStorage.getItem("authToken")){var e=!1,t=localStorage.getItem("authToken"),n=h.a.decode(t,{complete:!0}),s=new Date;n.payload.exp<s.getTime()/1e3&&(e=!0),e&&localStorage.clear()}}return Object(s.jsxs)(l.a,{children:[Object(s.jsx)(O,{checkExpiration:A}),Object(s.jsxs)(j.c,{children:[Object(s.jsx)(j.a,{exact:!0,path:"/",children:Object(s.jsx)(p,{setPosts:o,posts:n,checkExpiration:A})}),Object(s.jsx)(j.a,{path:"/posts/:id",children:Object(s.jsx)(m,{data:u,comments:v,setPostDetail:b,setPostComments:N,comment:C,setComment:P,onChange:B,checkExpiration:A})}),Object(s.jsx)(j.a,{path:"/login",children:Object(s.jsx)(d,{username:I,password:D,setUsername:U,setPassword:J,onChange:B})}),Object(s.jsx)(j.a,{path:"/signup",children:Object(s.jsx)(f,{username:I,password:D,setUsername:U,setPassword:J,onChange:B})})]})]})};r.a.render(Object(s.jsx)(o.a.StrictMode,{children:Object(s.jsx)(g,{})}),document.getElementById("root"))}},[[252,1,2]]]);
//# sourceMappingURL=main.fc252e55.chunk.js.map